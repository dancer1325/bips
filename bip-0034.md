```markdown
  BIP: 34
  Layer: Consensus (soft fork)
  Title: Block v2, Height in Coinbase
  Author: Gavin Andresen <gavinandresen@gmail.com>
  Comments-Summary: No comments yet.
  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0034
  Status: Final
  Type: Standards Track
  Created: 2012-07-06
```

# Abstract

* Bitcoin blocks and transactions
  * üí°== versioned binary structuresüí°
    * CURRENTLY,
      * v1
    * this BIP,
      * add an unique value | newly produced coinbase transactions
      * blocks v2

# Motivation

* clarify the bitcoin network collectively consents | upgrade
  * transaction or block binary structures,
  * rules
  * behaviors
* enforce block and transaction uniqueness
* support | validate unconnected block

# Specification

* transactions /
  * treated -- with a -- version / > 1 -- as -- non-standard
    * -> ‚ùåofficial Satoshi client will NOT mine OR relay them‚ùå

* | coinbase transaction's `scriptSig`
  * add height 
    * -- as the -- first item
    * 's format: "minimally encoded serialized CScript"
      * first byte == number of bytes | number 
        * == 0x03 | main net | next 150 years / 2<sup>23</sup>-1 blocks
      * following bytes == little-endian representation of the number (include a sign bit) 
    * == | block chain, mined block's height
      * genesis block's height == 0 
* increase block version: 2

* 75% rule
  * if 750 / last 1,000 blocks are version >=2 -> reject invalid version 2 blocks
    * | testnet3: 51 / last 100
* 95% rule ("Point of no return")
  * if 950 / last 1,000 blocks are version >=2 -> reject ALL v1 blocks
  * | testnet3: 75 / last 100

# Backward compatibility

* ALL older clients
  * are compatible
* Users and merchants
  * should NOT be impacted
* Miners
  * recommendation
    * upgrade to v2 blocks
* if 95% of the miners have upgraded to v2 & remainder fail to upgrade -> remainder will be orphaned 

# Implementation

https://github.com/bitcoin/bitcoin/pull/1526

# Result

* Block number 227,835 (timestamp 2013-03-24 15:49:13 GMT)
  * the last v1 block
